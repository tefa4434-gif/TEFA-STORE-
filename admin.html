<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - TEFA STORE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-5">

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginBox" class="max-w-sm mx-auto bg-white p-6 rounded-xl shadow">
  <h2 class="text-xl font-bold mb-4 text-center">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <input id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="w-full border p-2 rounded mb-3">
  <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full border p-2 rounded mb-4">
  <button onclick="login()" class="bg-black text-white w-full py-2 rounded">Ø¯Ø®ÙˆÙ„</button>
  <p id="loginError" class="text-red-500 text-center mt-3 hidden">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©</p>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div id="dashboard" class="hidden">

  <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ -->
  <div class="flex justify-between items-center mb-5">
    <h1 class="text-2xl font-bold">ğŸ“¦ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
    <button onclick="logout()" class="bg-red-600 text-white px-4 py-1 rounded">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
  </div>

  <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
  <div class="bg-white p-4 rounded-xl shadow mb-6 flex flex-wrap gap-4">
    <div>
      <p class="text-sm text-gray-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</p>
      <p id="totalOrders" class="text-xl font-bold">0</p>
    </div>
    <div>
      <p class="text-sm text-gray-500">Ø¹Ø¯Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
      <p id="todayOrders" class="text-xl font-bold text-green-700">0</p>
    </div>
  </div>

  <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† -->
  <div class="bg-white p-4 rounded-xl shadow mb-6">
    <h2 class="font-bold mb-3">ğŸ¨ Ø¥Ø¯Ø§Ø±Ø© Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬</h2>
    <div id="colorsContainer" class="mb-3 flex flex-wrap gap-2"></div>
    <div class="flex gap-2">
      <input id="newColor" placeholder="Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ† Ø¬Ø¯ÙŠØ¯" class="flex-1 border p-2 rounded">
      <button onclick="addColor()" class="bg-black text-white px-4 py-2 rounded">Ø¥Ø¶Ø§ÙØ©</button>
    </div>
    <p class="text-sm text-gray-500 mt-2">Ø£ÙŠ Ù„ÙˆÙ† ÙŠØªÙ… Ø­Ø°ÙÙ‡ Ù…Ù† Ù‡Ù†Ø§ Ù„Ù† ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨.</p>
  </div>

  <!-- ÙÙ„Ø§ØªØ± + Ø¨Ø­Ø« -->
  <div class="bg-white p-4 rounded-xl shadow mb-4 space-y-3">

    <input id="searchBox" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù‡Ø§ØªÙ / Ø§Ù„Ù…Ù†ØªØ¬ / Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©"
           class="w-full border p-2 rounded">

    <div class="flex flex-wrap gap-3 items-center">
      <div class="flex flex-col text-sm">
        <label class="mb-1">Ù…Ù† ØªØ§Ø±ÙŠØ®:</label>
        <input type="date" id="dateFrom" class="border p-2 rounded">
      </div>
      <div class="flex flex-col text-sm">
        <label class="mb-1">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:</label>
        <input type="date" id="dateTo" class="border p-2 rounded">
      </div>
      <div class="flex flex-col text-sm">
        <label class="mb-1">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</label>
        <select id="filterGovernorate" class="border p-2 rounded">
          <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
          <option>Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
          <option>Ø§Ù„Ø¬ÙŠØ²Ø©</option>
          <option>Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
          <option>Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©</option>
          <option>Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
          <option>Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
          <option>Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©</option>
          <option>Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©</option>
          <option>ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</option>
          <option>Ø¯Ù…ÙŠØ§Ø·</option>
          <option>Ø¨ÙˆØ± Ø³Ø¹ÙŠØ¯</option>
          <option>Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©</option>
          <option>Ø§Ù„Ø³ÙˆÙŠØ³</option>
          <option>Ø§Ù„Ø¨Ø­ÙŠØ±Ø©</option>
          <option>Ø§Ù„ÙÙŠÙˆÙ…</option>
          <option>Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ</option>
          <option>Ø§Ù„Ù…Ù†ÙŠØ§</option>
          <option>Ø£Ø³ÙŠÙˆØ·</option>
          <option>Ø³ÙˆÙ‡Ø§Ø¬</option>
          <option>Ù‚Ù†Ø§</option>
          <option>Ø§Ù„Ø£Ù‚ØµØ±</option>
          <option>Ø£Ø³ÙˆØ§Ù†</option>
          <option>Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±</option>
          <option>Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</option>
          <option>Ù…Ø·Ø±ÙˆØ­</option>
          <option>Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡</option>
          <option>Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡</option>
        </select>
      </div>
    </div>

  </div>

  <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
  <div id="ordersContainer" class="space-y-4"></div>

</div>

<script>
const ADMIN_USER = "admin";    // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
const ADMIN_PASS = "123456";   // ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…

const DEFAULT_COLORS = ["ÙƒØ§ÙÙŠÙ‡","Ø¨ÙŠØ¬","Ù…ÙˆÙ","Ø²ÙŠØªÙŠ","Ø£Ø³ÙˆØ¯","Ø³ÙŠÙ…ÙˆÙ†"];
let allOrders = [];

// Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ (Ù†ÙØ³Ù‡Ø§ Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ´ÙˆÙÙ‡Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ index.html)
function getColors(){
  let saved = localStorage.getItem("productColors");
  if(!saved){
    localStorage.setItem("productColors", JSON.stringify(DEFAULT_COLORS));
    return DEFAULT_COLORS;
  }
  try{
    const arr = JSON.parse(saved);
    if(Array.isArray(arr) && arr.length > 0) return arr;
    return DEFAULT_COLORS;
  }catch(e){
    return DEFAULT_COLORS;
  }
}

function saveColors(colors){
  localStorage.setItem("productColors", JSON.stringify(colors));
}

function renderColorsAdmin(){
  const colors = getColors();
  const container = document.getElementById("colorsContainer");
  container.innerHTML = "";
  if(colors.length === 0){
    container.innerHTML = "<p class='text-gray-500 text-sm'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù„ÙˆØ§Ù† Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§.</p>";
    return;
  }
  colors.forEach((color, index) => {
    const span = document.createElement("span");
    span.className = "inline-flex items-center gap-2 bg-gray-200 px-3 py-1 rounded-full text-sm";
    span.innerHTML = `
      <span>${color}</span>
      <button onclick="deleteColor(${index})" class="text-red-600 font-bold">Ã—</button>
    `;
    container.appendChild(span);
  });
}

function deleteColor(index){
  const colors = getColors();
  colors.splice(index, 1);
  saveColors(colors);
  renderColorsAdmin();
  alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­");
}

function addColor(){
  const input = document.getElementById("newColor");
  const val = input.value.trim();
  if(!val) return;
  const colors = getColors();
  if(!colors.includes(val)){
    colors.push(val);
    saveColors(colors);
    renderColorsAdmin();
  }
  input.value = "";
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
function login(){
  const user = document.getElementById("username").value;
  const pass = document.getElementById("password").value;

  if(user === ADMIN_USER && pass === ADMIN_PASS){
    localStorage.setItem("adminLogged", "true");
    showDashboard();
  } else {
    document.getElementById("loginError").classList.remove("hidden");
  }
}

function logout(){
  localStorage.removeItem("adminLogged");
  location.reload();
}

// Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨
function deleteOrder(origIndex){
  let orders = JSON.parse(localStorage.getItem("orders")) || [];
  if(!orders.length) return;
  if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ")) return;
  orders.splice(origIndex, 1);
  localStorage.setItem("orders", JSON.stringify(orders));
  location.reload();
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø©
function renderOrders(list){
  const container = document.getElementById("ordersContainer");
  container.innerHTML = "";
  if(list.length === 0){
    container.innerHTML = "<p class='text-center text-gray-500'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØµÙÙŠØ©/Ø§Ù„Ø¨Ø­Ø«</p>";
    return;
  }

  list.forEach(order => {
    const i = order._index;
    const card = document.createElement("div");
    card.className = "bg-white p-4 rounded-xl shadow";
    card.innerHTML = `
      <div class="flex justify-between items-center mb-2">
        <h2 class="font-bold">ğŸ§¾ Ø·Ù„Ø¨ Ø±Ù‚Ù… ${i + 1}</h2>
        <button onclick="deleteOrder(${i})"
                class="bg-red-600 text-white px-3 py-1 rounded text-sm">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>
      </div>
      <p><strong>Ø§Ù„Ù…Ù†ØªØ¬:</strong> <pre class="whitespace-pre-wrap inline">${order.product}</pre></p>
      <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${order.name}</p>
      <p><strong>Ù‡Ø§ØªÙ:</strong> ${order.phone1}</p>
      <p><strong>Ù‡Ø§ØªÙ 2:</strong> ${order.phone2 || "â€”"}</p>
      <p><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${order.address}</p>
      <p><strong>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©:</strong> ${order.governorate}</p>
      <p><strong>Ø§Ù„Ø´Ø­Ù†:</strong> ${order.shipping} Ø¬Ù†ÙŠÙ‡</p>
      <p class="font-bold"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${order.total} Ø¬Ù†ÙŠÙ‡</p>
      <p class="text-sm text-gray-500 mt-2">â± ${order.time}</p>
      <p class="mt-2"><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${order.notes || "â€”"}</p>
    `;
    container.appendChild(card);
  });
}

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± (Ø¨Ø­Ø« + ØªØ§Ø±ÙŠØ® + Ù…Ø­Ø§ÙØ¸Ø©)
function applyFilters(){
  const q = document.getElementById("searchBox").value.trim().toLowerCase();
  const govFilter = document.getElementById("filterGovernorate").value;
  const dateFromVal = document.getElementById("dateFrom").value;
  const dateToVal = document.getElementById("dateTo").value;

  let fromTs = null;
  let toTs = null;

  if(dateFromVal){
    fromTs = new Date(dateFromVal + "T00:00:00").getTime();
  }
  if(dateToVal){
    toTs = new Date(dateToVal + "T23:59:59").getTime();
  }

  const filtered = allOrders.filter(o => {
    // Ø¨Ø­Ø« Ù†ØµÙŠ
    if(q){
      const data = (o.name + " " + o.phone1 + " " + (o.phone2 || "") + " " +
                    o.product + " " + o.governorate).toLowerCase();
      if(!data.includes(q)) return false;
    }
    // ÙÙ„ØªØ± Ù…Ø­Ø§ÙØ¸Ø©
    if(govFilter && o.governorate !== govFilter) return false;

    // ÙÙ„ØªØ± ØªØ§Ø±ÙŠØ®
    if(typeof o.timestamp === "number"){
      if(fromTs !== null && o.timestamp < fromTs) return false;
      if(toTs !== null && o.timestamp > toTs) return false;
    }
    return true;
  });

  renderOrders(filtered);
}

// Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Ø¥Ø¬Ù…Ø§Ù„ÙŠ + Ø¹Ø¯Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…)
function calcStats(){
  const total = allOrders.length;
  document.getElementById("totalOrders").textContent = total;

  const today = new Date();
  const start = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0,0,0,0).getTime();
  const end   = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23,59,59,999).getTime();

  let countToday = 0;
  allOrders.forEach(o => {
    if(typeof o.timestamp === "number" && o.timestamp >= start && o.timestamp <= end){
      countToday += 1;
    }
  });

  document.getElementById("todayOrders").textContent = countToday;
}

// ØªØ´ØºÙŠÙ„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
function showDashboard(){
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("dashboard").classList.remove("hidden");

  renderColorsAdmin();

  const orders = JSON.parse(localStorage.getItem("orders")) || [];
  allOrders = orders.map((o, idx) => ({...o, _index: idx}));

  // ØªÙ†Ø¨ÙŠÙ‡ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©
  const lastCount = Number(localStorage.getItem("adminLastOrdersCount") || 0);
  if(orders.length > lastCount){
    const diff = orders.length - lastCount;
    alert("ğŸ“¢ Ù„Ø¯ÙŠÙƒ " + diff + " Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯");
  }
  localStorage.setItem("adminLastOrdersCount", String(orders.length));

  calcStats();
  renderOrders(allOrders);

  document.getElementById("searchBox").addEventListener("input", applyFilters);
  document.getElementById("filterGovernorate").addEventListener("change", applyFilters);
  document.getElementById("dateFrom").addEventListener("change", applyFilters);
  document.getElementById("dateTo").addEventListener("change", applyFilters);
}

// Ù„Ùˆ Ø§Ù„Ø£Ø¯Ù…Ù† ÙƒØ§Ù† Ù…Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡
if(localStorage.getItem("adminLogged") === "true"){
  showDashboard();
}
</script>

</body>
</html>