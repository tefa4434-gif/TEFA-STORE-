<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù† - TEFA STORE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Cairo", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
    }
    body {
      background: #f5f5f7;
      color: #111827;
    }
    header {
      padding: 10px 16px;
      background: #111827;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header .back {
      font-size: 14px;
      cursor: pointer;
    }
    main {
      max-width: 900px;
      margin: 16px auto 32px;
      padding: 0 16px;
    }
    .card {
      background: #fff;
      border-radius: 20px;
      padding: 14px 14px 18px;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);
    }
    .img-wrapper img {
      width: 100%;
      border-radius: 18px;
      margin-bottom: 10px;
    }
    .title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 4px;
    }
    .price-row {
      display: flex;
      align-items: baseline;
      gap: 6px;
      margin-bottom: 6px;
    }
    .price {
      font-size: 20px;
      font-weight: 800;
      color: #16a34a;
    }
    .old {
      font-size: 13px;
      color: #9ca3af;
      text-decoration: line-through;
    }
    .desc {
      font-size: 13px;
      color: #4b5563;
      margin-bottom: 6px;
    }
    .colors-label {
      margin: 10px 0 6px;
      font-size: 14px;
      font-weight: 700;
    }
    .colors-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }
    .color-dot {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: 2px solid #e5e7eb;
      cursor: pointer;
      position: relative;
    }
    .color-dot.selected {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
      border-color: #111827;
    }
    .colors-note {
      font-size: 12px;
      color: #ef4444;
      margin-bottom: 6px;
      display: none;
    }
    .quantity-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 8px 0 12px;
      font-size: 14px;
    }
    .quantity-controls {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
    }
    .quantity-controls button {
      width: 32px;
      height: 32px;
      border: none;
      background: #f3f4f6;
      cursor: pointer;
      font-size: 18px;
    }
    .quantity-value {
      width: 40px;
      text-align: center;
      font-size: 14px;
    }
    .btn-add {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 10px 12px;
      font-size: 15px;
      font-weight: 700;
      margin-top: 4px;
      background: #111827;
      color: #fff;
      cursor: pointer;
    }

    .toast {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 90%;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 14px;
      color: #fff;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s, transform 0.25s;
      z-index: 9999;
    }
    .toast.show {
      opacity: 1;
      transform: translate(-50%, -4px);
    }
  </style>
</head>
<body>
<header>
  <div class="back" onclick="window.location.href='index.html'">â¬… Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±</div>
  <div>TEFA STORE</div>
  <div style="width:40px"></div>
</header>

<main>
  <section class="card">
    <div class="img-wrapper">
      <img id="product-image" src="rozalin-main.jpg" alt="" />
    </div>
    <h1 class="title" id="product-title">Ø·Ù‚Ù… Ø±ÙˆØ²Ø§Ù„ÙŠÙ† 3 Ù‚Ø·Ø¹</h1>
    <div class="price-row">
      <div class="price" id="product-price">749 Ø¬</div>
      <div class="old" id="product-old">949 Ø¬</div>
    </div>
    <p class="desc" id="product-desc"></p>
    <p class="desc" id="product-extra"></p>

    <div class="colors-label">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ù„ÙˆÙ†</div>
    <div class="colors-row" id="colors-row"></div>
    <div class="colors-note" id="colors-note">
      Ø­Ø§Ù„ÙŠÙ‹Ø§ ÙƒÙ„ Ø£Ù„ÙˆØ§Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ù…ÙˆÙ‚ÙˆÙØ© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….
    </div>

    <div class="quantity-row">
      <span>Ø§Ù„ÙƒÙ…ÙŠØ©</span>
      <div class="quantity-controls">
        <button type="button" onclick="changeQty(-1)">âˆ’</button>
        <div class="quantity-value" id="qty-value">1</div>
        <button type="button" onclick="changeQty(1)">+</button>
      </div>
    </div>

    <button class="btn-add" onclick="addToCart()">
      Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© ğŸ›’
    </button>
  </section>
</main>

<div id="toast" class="toast"></div>

<audio id="beep-sound">
  <source
    src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"
    type="audio/ogg"
  />
</audio>

<script>
  const CART_KEY = "tefa_cart";
  const COLOR_STATUS_KEY = "tefa_color_status_v1";

  const PRODUCTS = {
    rozalin: {
      id: "rozalin",
      title: "Ø·Ù‚Ù… Ø±ÙˆØ²Ø§Ù„ÙŠÙ† 3 Ù‚Ø·Ø¹",
      price: 749,
      old: 949,
      image: "rozalin-main.jpg",
      desc:
        "Ø®Ø§Ù…Ø© Ø±ÙˆØ²Ø§Ù„ÙŠÙ† Ù…Ø³ØªÙˆØ±Ø¯ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© â€“ ÙˆØ§Ù† Ø³Ø§ÙŠØ² ØªÙ„Ø¨ÙŠØ³ Ù…Ù† 60 Ù„Ø­Ø¯ 95 ÙƒÙŠÙ„Ùˆ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§.",
      extra: "Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ 3 Ù‚Ø·Ø¹ Ø¬Ø§Ù‡Ø²ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø¨Ø³.",
      colors: [
        { name: "ÙƒØ§ÙÙŠÙ‡", code: "#c8a27a" },
        { name: "Ø¨ÙŠØ¬", code: "#e7d4b5" },
        { name: "Ù…ÙˆÙ", code: "#c084fc" },
        { name: "Ø²ÙŠØªÙŠ", code: "#4b7350" },
        { name: "Ø£Ø³ÙˆØ¯", code: "#111827" },
        { name: "Ø³ÙŠÙ…ÙˆÙ†", code: "#f9a8a8" },
        { name: "Ù…ÙˆÙ ØºØ§Ù…Ù‚", code: "#7c3aed" }
      ]
    },
    formal: {
      id: "formal",
      title: "Ø·Ù‚Ù… ÙÙˆØ±Ù…Ø§Ù„ 3 Ù‚Ø·Ø¹",
      price: 699,
      old: 949,
      image: "formal-main.jpg",
      desc:
        "Ø®Ø§Ù…Ø© Ø±ÙˆØ²Ø§Ù„ÙŠÙ† Ù…Ø³ØªÙˆØ±Ø¯ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© â€“ ÙˆØ§Ù† Ø³Ø§ÙŠØ² ØªÙ„Ø¨ÙŠØ³ Ù…Ù† 65 Ù„Ø­Ø¯ 85 ÙƒÙŠÙ„Ùˆ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§.",
      extra: "Ù…ÙˆØ¯ÙŠÙ„ ÙÙˆØ±Ù…Ø§Ù„ Ø´ÙŠÙƒ Ù„Ù„Ù…Ø´Ø§ÙˆÙŠØ± Ùˆ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª.",
      colors: [
        { name: "Ù…Ù†Øª", code: "#7cd3aa" },
        { name: "Ø¨ÙŠØ¨ÙŠ Ø¨Ù„Ùˆ", code: "#93c5fd" },
        { name: "Ø¨ÙŠØ¬", code: "#e7d4b5" },
        { name: "Ù‡Ø§ÙØ§Ù†", code: "#b45309" },
        { name: "Ø£Ø³ÙˆØ¯", code: "#111827" }
      ]
    },
    abaya: {
      id: "abaya",
      title: "Ø¹Ø¨Ø§ÙŠØ© Ø²Ø±Ø§ÙŠØ± ÙƒØ¨Ø³",
      price: 749,
      old: 1049,
      image: "abaya-main.jpg",
      desc:
        "Ø¬ÙˆØ® Ù„ÙŠÙƒØ±Ø§ Ù…Ø³ØªÙˆØ±Ø¯ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© â€“ ÙˆØ§Ù† Ø³Ø§ÙŠØ² ØªÙ„Ø¨ÙŠØ³ Ù„Ø­Ø¯ 80 ÙƒÙŠÙ„Ùˆ Ù…Ø±ØªØ§Ø­.",
      extra: "",
      colors: [
        { name: "Ø£Ø³ÙˆØ¯", code: "#111827" },
        { name: "Ø²ÙŠØªÙŠ", code: "#4b7350" },
        { name: "Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­", code: "#d1d5db" },
        { name: "Ù†Ø¨ÙŠØªÙŠ", code: "#7f1d1d" },
        { name: "ÙƒØ§Ø±Ø§Ù…ÙŠÙ„", code: "#b45309" },
        { name: "Ø±Ù…Ø§Ø¯ÙŠ ØºØ§Ù…Ù‚", code: "#4b5563" }
      ]
    },
    toonz: {
      id: "toonz",
      title: "Ù…ÙˆØ¯ÙŠÙ„ ØªÙˆÙ†Ø² Ù‚Ø·Ø¹ØªÙŠÙ†",
      price: 799,
      old: 1199,
      image: "toonz-main.jpg",
      desc: "Ø§Ù„Ø®Ø§Ù…Ø© Ø´Ù…ÙˆØ§Ù‡ Ã— Ø´Ù…ÙˆØ§Ù‡ Ù†Ø§Ø¹Ù…Ø© â€“ Ù…Ù† 60 Ù„Ø­Ø¯ 90 ÙƒÙŠÙ„Ùˆ Ù…Ø±ØªØ§Ø­.",
      extra: "",
      colors: [
        { name: "Ø£Ø²Ø±Ù‚", code: "#1d4ed8" },
        { name: "Ø¨ÙŠÙ†Ùƒ", code: "#f9a8d4" },
        { name: "Ø£ÙˆÙ ÙˆØ§ÙŠØª", code: "#fef9c3" },
        { name: "Ø²ÙŠØªÙŠ", code: "#4b7350" },
        { name: "Ù†Ø¨ÙŠØªÙŠ", code: "#7f1d1d" },
        { name: "Ø¨Ù†ÙØ³Ø¬ÙŠ", code: "#7c3aed" }
      ]
    }
  };

  let currentProduct = PRODUCTS.rozalin;
  let selectedColor = null;
  let quantity = 1;

  function getProductFromURL() {
    const params = new URLSearchParams(window.location.search);
    const p = params.get("product");
    if (p && PRODUCTS[p]) {
      currentProduct = PRODUCTS[p];
    }
  }

  function getColorStatus() {
    try {
      return JSON.parse(localStorage.getItem(COLOR_STATUS_KEY)) || {};
    } catch (e) {
      return {};
    }
  }

  function renderProduct() {
    document.getElementById("product-image").src = currentProduct.image;
    document.getElementById("product-title").textContent =
      currentProduct.title;
    document.getElementById("product-price").textContent =
      currentProduct.price + " Ø¬";
    document.getElementById("product-old").textContent =
      currentProduct.old + " Ø¬";
    document.getElementById("product-desc").textContent =
      currentProduct.desc;
    document.getElementById("product-extra").textContent =
      currentProduct.extra || "";

    const colorsRow = document.getElementById("colors-row");
    const colorsNote = document.getElementById("colors-note");
    colorsRow.innerHTML = "";
    selectedColor = null;

    const status = getColorStatus();
    const productStatus = status[currentProduct.id] || {};

    const enabledColors = currentProduct.colors.filter((c) => {
      // Ù„Ùˆ Ø§Ù„Ù„ÙˆÙ† Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø³ØªØ§ØªØ³ â†’ Ø´ØºØ§Ù„
      if (typeof productStatus[c.name] === "undefined") return true;
      return !!productStatus[c.name]; // true â†’ Ø´ØºØ§Ù„ ØŒ false â†’ Ù…ØªÙˆÙ‚Ù
    });

    if (!enabledColors.length) {
      colorsNote.style.display = "block";
      return;
    } else {
      colorsNote.style.display = "none";
    }

    enabledColors.forEach((c, index) => {
      const dot = document.createElement("div");
      dot.className = "color-dot";
      dot.style.background = c.code;
      dot.dataset.name = c.name;
      dot.dataset.color = c.code;
      dot.addEventListener("click", () => selectColor(dot));
      colorsRow.appendChild(dot);
      if (index === 0) {
        // Ø£ÙˆÙ„ Ù„ÙˆÙ† Ø§ÙØªØ±Ø§Ø¶ÙŠ
        selectColor(dot);
      }
    });
  }

  function selectColor(dot) {
    document
      .querySelectorAll(".color-dot")
      .forEach((d) => d.classList.remove("selected"));
    dot.classList.add("selected");
    selectedColor = {
      name: dot.dataset.name,
      code: dot.dataset.color
    };
  }

  function changeQty(delta) {
    quantity = Math.min(10, Math.max(1, quantity + delta));
    document.getElementById("qty-value").textContent = quantity;
  }

  function addToCart() {
    if (!selectedColor) {
      showToast("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ§Ø±ÙŠ Ù„ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„ ğŸ’–", "#111827");
      return;
    }

    const raw = localStorage.getItem(CART_KEY);
    let items = [];
    if (raw) {
      try {
        items = JSON.parse(raw);
      } catch (e) {}
    }

    // Ù„Ùˆ Ù†ÙØ³ Ø§Ù„Ù…Ù†ØªØ¬ ÙˆÙ†ÙØ³ Ø§Ù„Ù„ÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯ -> Ù†Ø²ÙˆØ¯ Ø§Ù„ÙƒÙ…ÙŠØ©
    const existing = items.find(
      (i) =>
        i.productId === currentProduct.id &&
        i.colorName === selectedColor.name
    );
    if (existing) {
      existing.quantity += quantity;
    } else {
      items.push({
        productId: currentProduct.id,
        productName: currentProduct.title,
        colorName: selectedColor.name,
        colorCode: selectedColor.code,
        quantity: quantity,
        price: currentProduct.price
      });
    }

    localStorage.setItem(CART_KEY, JSON.stringify(items));

    const audio = document.getElementById("beep-sound");
    if (audio && audio.play) {
      audio.currentTime = 0;
      audio.play().catch(() => {});
    }

    showToast(
      `ØªÙ… Ø¥Ø¶Ø§ÙØ© ${quantity} Ã— Ù„ÙˆÙ† (${selectedColor.name}) Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© ğŸ›’`,
      selectedColor.code
    );
  }

  function showToast(message, color) {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.style.background = color || "#111827";
    toast.classList.add("show");
    setTimeout(() => {
      toast.classList.remove("show");
    }, 2000);
  }

  getProductFromURL();
  renderProduct();
</script>
</body>
</html>