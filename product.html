<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>TEFA STORE | ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 font-sans">

<!-- Ù‡ÙŠØ¯Ø± -->
<header class="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-40">
  <a href="index.html" class="text-sm">â¬… Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±</a>
  <span class="font-bold text-lg">TEFA STORE</span>
  <a href="cart.html" class="text-2xl">ğŸ›’</a>
</header>

<main class="max-w-md mx-auto p-4">
  <div id="productContainer"></div>
</main>

<!-- ØµÙˆØª Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© (Ø§Ø±ÙØ¹ Ù…Ù„Ù add-to-cart.mp3 ÙÙŠ Ø¬Øª Ù‡Ø¨) -->
<audio id="addSound" src="add-to-cart.mp3" preload="auto"></audio>

<script>
// ======================= Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ø¹Ù†Ø¯Ùƒ) =======================
const PRODUCTS = {
  rozalin: {
    name: "Ø·Ù‚Ù… Ø±ÙˆØ²Ø§Ù„ÙŠÙ† 3 Ù‚Ø·Ø¹",
    price: 749,
    oldPrice: 999,
    mainImg: "rozalin-main.jpg",
    desc: "Ø®Ø§Ù…Ø© Ø±ÙˆØ²Ø§Ù„ÙŠÙ† Ù…Ø³ØªÙˆØ±Ø¯Ø© â€“ ÙˆØ§Ù† Ø³Ø§ÙŠØ² Ù…Ù† 60 Ù„Ù€ 95 Ùƒ.",
    colors: [
      { label: "ÙƒØ§ÙÙŠÙ‡", hex: "#8b6a4f", img: "rozalin-kafeh.jpg" },
      { label: "Ø¨ÙŠØ¬",   hex: "#ead7b7", img: "rozalin-beige.jpg" },
      { label: "Ù…ÙˆÙ",   hex: "#7c3aed", img: "rozalin-mov.jpg" },
      { label: "Ø²ÙŠØªÙŠ",  hex: "#4b7351", img: "rozalin-zyti.jpg" },
      { label: "Ø£Ø³ÙˆØ¯",  hex: "#000000", img: "rozalin-black.jpg" },
      { label: "Ø³ÙŠÙ…ÙˆÙ†", hex: "#f4a6a6", img: "rozalin-simon.jpg" }
    ]
  },

  formal: {
    name: "Ø·Ù‚Ù… ÙÙˆØ±Ù…Ø§Ù„ 3 Ù‚Ø·Ø¹",
    price: 699,
    oldPrice: 949,
    mainImg: "formal-main.jpg",
    desc: "Ø®Ø§Ù…Ø© Ø±ÙˆØ²Ø§Ù„ÙŠÙ† Ù…Ø³ØªÙˆØ±Ø¯Ø© â€“ ÙˆØ§Ù† Ø³Ø§ÙŠØ² ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ Ù…Ù† 65 Ù„Ù€ 85 Ùƒ.",
    colors: [
      { label: "Ù…Ù†Øª",      hex: "#98ff98", img: "formal-ment.jpg" },
      { label: "Ø¨ÙŠØ¨ÙŠ Ø¨Ù„Ùˆ", hex: "#a7c7ff", img: "formal-babyblue.jpg" },
      { label: "Ø¨ÙŠØ¬",      hex: "#ead7b7", img: "formal-beige.jpg" },
      { label: "Ù‡Ø§ÙØ§Ù†",    hex: "#8b5a2b", img: "formal-havan.jpg" },
      { label: "Ø£Ø³ÙˆØ¯",     hex: "#000000", img: "formal-black.jpg" }
    ]
  },

  toonz: {
    name: "ØªÙˆÙ†Ø² â€“ Ù‚Ø·Ø¹ØªÙŠÙ†",
    price: 799,
    oldPrice: 1199,
    mainImg: "toonz-main.jpg",
    desc: "Ø´Ù…ÙˆØ§Ù‡ Ã— Ø´Ù…ÙˆØ§Ù‡ â€“ ÙˆØ§Ù† Ø³Ø§ÙŠØ² Ù…Ù† 60 Ù„Ù€ 90 Ùƒ.",
    colors: [
      { label: "Ø£Ø²Ø±Ù‚",  hex: "#1e3a8a", img: "toonz-main.jpg" }, // Ù…ÙÙŠØ´ ØµÙˆØ±Ø© Ù…Ù†ÙØµÙ„Ø©ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒÙˆÙ„Ø§Ø¬
      { label: "Ø¨ÙŠÙ†Ùƒ",  hex: "#ec4899", img: "toonz-pink.jpg" },
      { label: "Ø¨ÙŠØ¬",   hex: "#ead7b7", img: "toonz-beige.jpg" },
      { label: "Ø²ÙŠØªÙŠ",  hex: "#6b8f71", img: "toonz-olive.jpg" },
      { label: "Ù†Ø¨ÙŠØªÙŠ", hex: "#6d1b1b", img: "toonz-wine.jpg" },
      { label: "Ù…ÙˆÙ",   hex: "#7c3aed", img: "toonz-purple.jpg" }
    ]
  },

  abaya_btn: {
    name: "Ø¹Ø¨Ø§ÙŠØ© Ø²Ø±Ø§ÙŠØ± ÙƒØ¨Ø³",
    price: 749,
    oldPrice: 1049,
    mainImg: "abaya-btn-main.jpg",
    desc: "Ø¬ÙˆØ® Ù„ÙŠÙƒØ±Ø§ Ù…Ø³ØªÙˆØ±Ø¯ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© â€“ ÙˆØ§Ù† Ø³Ø§ÙŠØ² ØªÙ„Ø¨ÙŠØ³ Ù„Ø­Ø¯ 80Ùƒ.",
    colors: [
      { label: "ÙƒØ±Ø§Ù…ÙŠÙ„",     hex: "#c19a6b", img: "abaya-caramel.jpg" },
      { label: "Ù†Ø¨ÙŠØªÙŠ",      hex: "#6b1b1b", img: "abaya-burgundy.jpg" },
      { label: "Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­", hex: "#d1d5db", img: "abaya-lightgray.jpg" },
      { label: "Ø²ÙŠØªÙŠ",       hex: "#6b8f71", img: "abaya-green.jpg" },
      { label: "Ø£Ø³ÙˆØ¯",       hex: "#000000", img: "abaya-black.jpg" },
      { label: "Ø±Ù…Ø§Ø¯ÙŠ ØºØ§Ù…Ù‚", hex: "#374151", img: "abaya-darkgray.jpg" }
    ]
  }
};

// ======================= Ø£Ù„ÙˆØ§Ù† Ù…ÙˆÙ‚ÙˆÙØ© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… =======================
function loadDisabledColors() {
  try {
    return JSON.parse(localStorage.getItem("disabledColors") || "{}");
  } catch (e) {
    return {};
  }
}
const disabledColors = loadDisabledColors();

function isColorDisabled(pid, label) {
  return disabledColors[pid] && disabledColors[pid][label] === false;
}

// ======================= ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù€ URL =======================
const params = new URLSearchParams(location.search);
const productId = params.get("id") || "rozalin";
const product = PRODUCTS[productId] || PRODUCTS.rozalin;

let qty = 1;

// Ø£ÙˆÙ„ Ù„ÙˆÙ† Ø´ØºÙ‘Ø§Ù„ (Ù…Ø´ Ù…ÙˆÙ‚ÙˆÙ)
let selectedColorIndex = product.colors.findIndex(c => !isColorDisabled(productId, c.label));
if (selectedColorIndex === -1) selectedColorIndex = 0;

// ======================= Ø±Ø³Ù… ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬ =======================
const container = document.getElementById("productContainer");
container.innerHTML = `
  <div class="bg-white rounded-3xl shadow p-4">
    <img id="mainImg"
         src="${product.mainImg}"
         alt="${product.name}"
         class="w-full rounded-2xl mb-4 object-cover">

    <div class="text-right mb-4">
      <h1 class="text-2xl font-extrabold mb-1">${product.name}</h1>
      <div class="flex items-baseline justify-end gap-2">
        ${product.oldPrice ? `<span class="line-through text-gray-400 text-sm">${product.oldPrice} Ø¬</span>` : ""}
        <span class="text-3xl font-extrabold text-black">${product.price} Ø¬</span>
      </div>
      <p class="text-gray-700 mt-2 text-sm md:text-base">
        ${product.desc}
      </p>
    </div>

    <div class="flex justify-between items-center mb-2">
      <span class="text-sm text-gray-700 font-semibold">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ù„ÙˆÙ†</span>
    </div>
    <div id="colorsRow" class="flex flex-wrap gap-3 mb-4"></div>

    <div class="flex justify-between items-center mb-2">
      <span class="text-sm text-gray-700 font-semibold">Ø§Ù„ÙƒÙ…ÙŠØ©</span>
    </div>
    <div class="flex items-center justify-start gap-4 mb-4">
      <button id="decQty"
        class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-xl">-</button>
      <span id="qtyValue" class="text-xl font-bold">1</span>
      <button id="incQty"
        class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-xl">+</button>
    </div>

    <button id="addToCartBtn"
      class="bg-black text-white w-full py-4 rounded-2xl text-xl font-extrabold">
      Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
    </button>

    <!-- Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆÙ† -->
    <p id="successMsg"
       class="hidden text-center mt-3 font-bold text-sm rounded-2xl px-3 py-2">
      âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­ ğŸ¥°
    </p>
  </div>
`;

// ======================= ØªÙ‡ÙŠØ¦Ø© Ø¯ÙˆØ§Ø¦Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù† =======================
const colorsRow  = document.getElementById("colorsRow");
const mainImg    = document.getElementById("mainImg");
const qtyValue   = document.getElementById("qtyValue");
const incQtyBtn  = document.getElementById("incQty");
const decQtyBtn  = document.getElementById("decQty");
const addBtn     = document.getElementById("addToCartBtn");
const successMsg = document.getElementById("successMsg");
const addSound   = document.getElementById("addSound");

mainImg.dataset.main = product.mainImg;
mainImg.onerror = function () {
  this.onerror = null;
  this.src = this.dataset.main;
};

const colorDots = [];

product.colors.forEach((col, idx) => {
  const disabled = isColorDisabled(productId, col.label);

  const dot = document.createElement("span");
  dot.className =
    "w-10 h-10 rounded-full border cursor-pointer transition";
  dot.style.backgroundColor = col.hex;
  dot.dataset.index = idx;
  dot.dataset.disabled = disabled ? "1" : "0";

  if (disabled) {
    dot.classList.add("opacity-30", "cursor-not-allowed");
  } else {
    dot.classList.add("border-gray-300");
  }

  colorsRow.appendChild(dot);
  colorDots.push(dot);
});

function updateSelectedColor() {
  colorDots.forEach((dot, idx) => {
    if (idx === selectedColorIndex && dot.dataset.disabled !== "1") {
      dot.classList.add("ring-2", "ring-black");
    } else {
      dot.classList.remove("ring-2", "ring-black");
    }
  });

  const col = product.colors[selectedColorIndex];
  if (col && col.img && colorDots[selectedColorIndex].dataset.disabled !== "1") {
    mainImg.src = col.img;
  } else {
    mainImg.src = mainImg.dataset.main;
  }
}

// Ø£ÙˆÙ„ ØªØ­Ø¯ÙŠØ«
updateSelectedColor();

colorsRow.addEventListener("click", (e) => {
  const dot = e.target.closest("span");
  if (!dot) return;
  if (dot.dataset.disabled === "1") {
    alert("Ù‡Ø°Ø§ Ø§Ù„Ù„ÙˆÙ† Ù…ÙˆÙ‚ÙˆÙ Ø­Ø§Ù„ÙŠÙ‹Ø§ âŒ");
    return;
  }
  const idx = parseInt(dot.dataset.index, 10);
  if (isNaN(idx)) return;
  selectedColorIndex = idx;
  updateSelectedColor();
});

// ======================= Ø§Ù„ÙƒÙ…ÙŠØ© =======================
incQtyBtn.addEventListener("click", () => {
  qty++;
  qtyValue.textContent = qty;
});

decQtyBtn.addEventListener("click", () => {
  if (qty > 1) {
    qty--;
    qtyValue.textContent = qty;
  }
});

// ======================= Ø§Ù„Ø³Ù„Ø© (localStorage) =======================
function loadCart() {
  try {
    return JSON.parse(localStorage.getItem("cart") || "[]");
  } catch (e) {
    return [];
  }
}
function saveCart(cart) {
  localStorage.setItem("cart", JSON.stringify(cart));
}

addBtn.addEventListener("click", () => {
  const col = product.colors[selectedColorIndex];

  if (!col || isColorDisabled(productId, col.label)) {
    alert("Ù‡Ø°Ø§ Ø§Ù„Ù„ÙˆÙ† Ù…ÙˆÙ‚ÙˆÙ ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø·Ù„Ø¨Ù‡ Ø­Ø§Ù„ÙŠÙ‹Ø§ âŒ");
    return;
  }

  const cart = loadCart();

  cart.push({
    productId: productId,
    name: product.name,
    price: product.price,
    color: col.label,
    colorHex: col.hex,
    qty: qty
  });

  saveCart(cart);

  // âœ… Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ø¨Ù†ÙØ³ Ù„ÙˆÙ† Ø§Ù„Ù„ÙˆÙ†
  successMsg.style.backgroundColor = col.hex;
  // Ù„Ùˆ Ø§Ù„Ù„ÙˆÙ† ØºØ§Ù…Ù‚ Ù†Ø®Ù„ÙŠ Ø§Ù„Ø®Ø· Ø£Ø¨ÙŠØ¶ØŒ Ù„Ùˆ ÙØ§ØªØ­ Ù†Ø®Ù„ÙŠÙ‡ Ø£Ø³ÙˆØ¯
  successMsg.style.color = isDarkColor(col.hex) ? "#ffffff" : "#000000";

  successMsg.classList.remove("hidden");
  setTimeout(() => {
    successMsg.classList.add("hidden");
  }, 2000);

  // ğŸ”Š ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
  if (addSound) {
    try {
      addSound.currentTime = 0;
      addSound.play().catch(() => {});
    } catch(e) {}
  }
});

// Ø¯Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø¥Ø°Ø§ Ø§Ù„Ù„ÙˆÙ† ØºØ§Ù…Ù‚ ÙˆÙ„Ø§ Ù„Ø§
function isDarkColor(hex) {
  const h = hex.replace("#","");
  if (h.length !== 6) return false;
  const r = parseInt(h.substr(0,2), 16);
  const g = parseInt(h.substr(2,2), 16);
  const b = parseInt(h.substr(4,2), 16);
  // Ù…Ø¹Ø§Ø¯Ù„Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø³Ø·ÙˆØ¹
  const brightness = (r*299 + g*587 + b*114) / 1000;
  return brightness < 140;
}
</script>

</body>
</html>