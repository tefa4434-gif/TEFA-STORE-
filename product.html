<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>TEFA STORE - Ø§Ù„Ù…Ù†ØªØ¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-200">

<header class="bg-gray-300 p-4 flex justify-between items-center">
  <a href="index.html" class="text-sm">â† Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <h1 class="text-lg font-bold">TEFA STORE</h1>
  <button id="cartBtn" class="relative text-2xl">
    ğŸ›’
    <span id="cartCount"
      class="absolute -top-2 -left-2 bg-black text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">0</span>
  </button>
</header>

<!-- Ù‡Ù†Ø§ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
<section class="container mx-auto p-4">
  <div id="productBox" class="bg-white rounded-xl shadow p-3 text-center"></div>
</section>

<!-- Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
<section id="cartSection"
  class="hidden container mx-auto bg-white p-4 rounded-xl shadow mt-4">
  <h3 class="text-center font-bold mb-3">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
  <div id="cartItems"></div>
  <p class="text-sm mt-2">
    Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: <span id="cartTotal">0</span> Ø¬Ù†ÙŠÙ‡
  </p>
  <button id="goForm"
    class="bg-black text-white w-full mt-3 p-2 rounded">
    Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
  </button>
</section>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
<section id="orderSection"
  class="hidden container mx-auto bg-white p-4 mt-4 rounded-xl shadow">

  <form id="orderForm" class="space-y-3">

    <textarea id="selectedProduct" readonly
      class="w-full border p-2 rounded bg-gray-100 text-sm"></textarea>

    <input id="fullName" required placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full border p-2 rounded">
    <input id="phone1" required placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full border p-2 rounded">
    <input id="phone2" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙ 2" class="w-full border p-2 rounded">
    <input id="address" required placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="w-full border p-2 rounded">

    <input id="weight" placeholder="Ø§Ù„ÙˆØ²Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="w-full border p-2 rounded">
    <input id="height" placeholder="Ø§Ù„Ø·ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="w-full border p-2 rounded">

    <select id="governorate" required class="w-full border p-2 rounded">
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
      <option>Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
      <option>Ø§Ù„Ø¬ÙŠØ²Ø©</option>
      <option>Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
      <option>Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©</option>
      <option>Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
      <option>Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
      <option>Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©</option>
      <option>Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©</option>
      <option>Ø³ÙˆÙ‡Ø§Ø¬</option>
      <option>Ø£Ø³ÙŠÙˆØ·</option>
      <option>Ù‚Ù†Ø§</option>
      <option>Ø£Ø³ÙˆØ§Ù†</option>
      <option>Ø§Ù„Ø£Ù‚ØµØ±</option>
      <option>Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</option>
    </select>

    <textarea id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"
      class="w-full border p-2 rounded"></textarea>

    <div id="orderSummary" class="hidden bg-gray-100 p-2 rounded text-sm">
      <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: <span id="sumProducts"></span> Ø¬Ù†ÙŠÙ‡</p>
      <p>Ø§Ù„Ø´Ø­Ù†: <span id="sumShipping"></span> Ø¬Ù†ÙŠÙ‡</p>
      <p class="font-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="sumTotal"></span> Ø¬Ù†ÙŠÙ‡</p>
    </div>

    <button class="bg-black text-white w-full p-3 rounded">
      ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
    </button>

  </form>
</section>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
const PRODUCTS = {
  rozalin: {
    name: "Ø·Ù‚Ù… Ø±ÙˆØ²Ø§Ù„ÙŠÙ† 3 Ù‚Ø·Ø¹",
    price: 749,
    oldPrice: 999,
    mainImg: "rozalin-main.jpg",
    desc: "",
    colors: ["ÙƒØ§ÙÙŠÙ‡","Ø¨ÙŠØ¬","Ù…ÙˆÙ","Ø²ÙŠØªÙŠ","Ø£Ø³ÙˆØ¯","Ø³ÙŠÙ…ÙˆÙ†"]
  },
  formal: {
    name: "Ø·Ù‚Ù… ÙÙˆØ±Ù…Ø§Ù„ 3 Ù‚Ø·Ø¹",
    price: 699,
    oldPrice: 949,
    mainImg: "formal-main.jpg",
    desc: "Ø§Ù„Ø®Ø§Ù…Ø© Ø±ÙˆØ²Ø§Ù„ÙŠÙ† Ù…Ø³ØªÙˆØ±Ø¯ â€“ ÙˆØ§Ù† Ø³Ø§ÙŠØ² Ù…Ù† 65Ùƒ Ù„Ù€ 85Ùƒ",
    colors: ["Ù…Ù†Øª","Ø¨ÙŠØ¨ÙŠ Ø¨Ù„Ùˆ","Ø¨ÙŠØ¬","Ù‡Ø§ÙØ§Ù†","Ø£Ø³ÙˆØ¯"]
  }
};

let cart = [];

// Ø¹Ù†Ø§ØµØ± Ø¹Ø§Ù…Ø©
const cartBtn      = document.getElementById("cartBtn");
const cartCountEl  = document.getElementById("cartCount");
const cartSection  = document.getElementById("cartSection");
const cartItemsEl  = document.getElementById("cartItems");
const cartTotalEl  = document.getElementById("cartTotal");
const goFormBtn    = document.getElementById("goForm");

const orderSection = document.getElementById("orderSection");
const orderForm    = document.getElementById("orderForm");
const selectedProductEl = document.getElementById("selectedProduct");
const sumProductsEl = document.getElementById("sumProducts");
const sumShippingEl = document.getElementById("sumShipping");
const sumTotalEl    = document.getElementById("sumTotal");
const orderSummary  = document.getElementById("orderSummary");

const fullNameEl   = document.getElementById("fullName");
const phone1El     = document.getElementById("phone1");
const phone2El     = document.getElementById("phone2");
const addressEl    = document.getElementById("address");
const weightEl     = document.getElementById("weight");
const heightEl     = document.getElementById("height");
const governorateEl= document.getElementById("governorate");
const notesEl      = document.getElementById("notes");

// Ù‚Ø±Ø§Ø¡Ø© ID Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©
const params = new URLSearchParams(window.location.search);
const productId = params.get("id") || "rozalin";
const productData = PRODUCTS[productId] || PRODUCTS["rozalin"];

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ù„Ø© Ù…Ù† localStorage
try {
  cart = JSON.parse(localStorage.getItem("cart") || "[]");
} catch(e){
  cart = [];
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù„Ø©
function updateCartBadge(){
  const totalQty = cart.reduce((sum, item) => sum + (item.qty || 0), 0);
  cartCountEl.textContent = totalQty;
}
updateCartBadge();

// Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†ØªØ¬
function renderProduct(){
  const box = document.getElementById("productBox");
  box.innerHTML = `
    <img src="${productData.mainImg}"
         class="productImg w-full aspect-[3/4] rounded mb-2 object-cover"
         alt="${productData.name}">
    <h2 class="font-bold text-base mb-1">${productData.name}</h2>
    <p class="line-through text-xs text-red-500">${productData.oldPrice} Ø¬Ù†ÙŠÙ‡</p>
    <p class="font-bold text-sm mb-1">ğŸ”¥ ${productData.price} Ø¬Ù†ÙŠÙ‡</p>
    ${productData.desc ? `<p class="text-[11px] text-gray-600 mb-2">${productData.desc}</p>` : ""}
    <p class="text-[11px] text-gray-500 mb-2">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† ÙˆØ§Ù„ÙƒÙ…ÙŠØ© Ø«Ù… Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</p>
    <div id="colorsArea" class="space-y-2 text-right mb-3"></div>
    <button id="addToCartBtn"
      class="bg-black text-white w-full p-2 rounded text-sm">
      Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
    </button>
  `;

  const colorsArea = document.getElementById("colorsArea");

  productData.colors.forEach(color => {
    const row = document.createElement("div");
    row.className = "flex justify-between items-center border rounded p-1 bg-gray-50";
    row.innerHTML = `
      <span class="text-xs">${color}</span>
      <div class="flex gap-1 items-center">
        <button type="button" class="dec px-2 text-xs bg-gray-200 rounded">âˆ’</button>
        <input type="number" min="0" value="0"
               class="qty w-10 text-center border rounded text-xs">
        <button type="button" class="inc px-2 text-xs bg-gray-200 rounded">+</button>
      </div>
    `;
    colorsArea.appendChild(row);
  });

  // Ø£Ø²Ø±Ø§Ø± + Ùˆ -
  colorsArea.addEventListener("click", (e) => {
    if(e.target.classList.contains("inc") || e.target.classList.contains("dec")){
      const row = e.target.closest("div");
      const input = row.querySelector(".qty");
      let val = parseInt(input.value) || 0;
      if(e.target.classList.contains("inc")) val++;
      if(e.target.classList.contains("dec") && val > 0) val--;
      input.value = val;
    }
  });

  // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
  document.getElementById("addToCartBtn").addEventListener("click", () => {
    const rows = colorsArea.querySelectorAll(".qty");
    let added = false;

    rows.forEach((inp, idx) => {
      const qty = parseInt(inp.value) || 0;
      if(qty > 0){
        added = true;
        const colorName = productData.colors[idx];
        cart.push({
          productId: productId,
          name: productData.name,
          color: colorName,
          qty: qty,
          price: productData.price
        });
        inp.value = 0;
      }
    });

    if(!added){
      alert("Ø§Ø®ØªØ± ÙƒÙ…ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù…Ù† Ù„ÙˆÙ† ÙˆØ§Ø­Ø¯.");
      return;
    }

    saveCart();
    updateCartBadge();
    updateCartUI();
    alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©");
  });
}

// Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø©
function saveCart(){
  localStorage.setItem("cart", JSON.stringify(cart));
}

// ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ù„Ø©
function updateCartUI(){
  cartItemsEl.innerHTML = "";
  let total = 0;

  if(cart.length === 0){
    cartItemsEl.innerHTML = `<p class="text-center text-sm text-gray-500">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>`;
    cartTotalEl.textContent = "0";
    saveCart();
    updateCartBadge();
    return;
  }

  cart.forEach((item, index) => {
    const subtotal = item.qty * item.price;
    total += subtotal;
    const div = document.createElement("div");
    div.className = "border p-2 rounded mb-1 text-xs flex justify-between items-center bg-gray-50";
    div.innerHTML = `
      <div class="text-right">
        <p><strong>${item.name}</strong></p>
        <p>Ø§Ù„Ù„ÙˆÙ†: ${item.color} - Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty}</p>
        <p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${subtotal} Ø¬Ù†ÙŠÙ‡</p>
      </div>
      <button type="button" data-index="${index}"
              class="text-red-600 text-[11px]">Ø­Ø°Ù</button>
    `;
    cartItemsEl.appendChild(div);
  });

  cartTotalEl.textContent = total;
  saveCart();
  updateCartBadge();
}

// Ø­Ø°Ù Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø³Ù„Ø©
cartItemsEl.addEventListener("click", (e) => {
  if(e.target.matches("button[data-index]")){
    const i = parseInt(e.target.dataset.index);
    cart.splice(i, 1);
    updateCartUI();
  }
});

// ÙØªØ­/ØºÙ„Ù‚ Ø§Ù„Ø³Ù„Ø©
cartBtn.addEventListener("click", () => {
  if(cart.length === 0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠÙ‹Ø§.");
    return;
  }
  cartSection.classList.toggle("hidden");
  if(!cartSection.classList.contains("hidden")){
    cartSection.scrollIntoView({behavior: "smooth"});
  }
});

// Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
goFormBtn.addEventListener("click", () => {
  if(cart.length === 0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.");
    return;
  }

  let text = "";
  let total = 0;
  cart.forEach((item, idx) => {
    const sub = item.qty * item.price;
    total += sub;
    text += `${idx+1}) ${item.name} - ${item.color} Ã— ${item.qty} = ${sub} Ø¬Ù†ÙŠÙ‡\n`;
  });

  selectedProductEl.value = text;
  sumProductsEl.textContent = total;
  updateSummary();
  orderSection.classList.remove("hidden");
  orderSection.scrollIntoView({behavior: "smooth"});
});

// Ø­Ø³Ø§Ø¨ Ù…Ù„Ø®Øµ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
function updateSummary(){
  const productsTotal = parseInt(sumProductsEl.textContent) || 0;
  let shipping = 70;
  if(governorateEl.value === "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©") shipping = 60;
  sumShippingEl.textContent = shipping;
  sumTotalEl.textContent = productsTotal + shipping;
  orderSummary.classList.remove("hidden");
}
governorateEl.addEventListener("change", updateSummary);

// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
orderForm.addEventListener("submit", (e) => {
  e.preventDefault();

  const shipping = parseInt(sumShippingEl.textContent) || 0;
  const total = parseInt(sumTotalEl.textContent) || 0;
  const now = new Date();

  const orderData = {
    product: selectedProductEl.value,
    name: fullNameEl.value,
    phone1: phone1El.value,
    phone2: phone2El.value,
    address: addressEl.value,
    weight: weightEl.value,
    height: heightEl.value,
    governorate: governorateEl.value,
    notes: notesEl.value,
    shipping: shipping,
    total: total,
    time: now.toLocaleString("ar-EG"),
    timestamp: now.getTime()
  };

  const orders = JSON.parse(localStorage.getItem("orders") || "[]");
  orders.push(orderData);
  localStorage.setItem("orders", JSON.stringify(orders));

  // ÙØ¶ÙŠ Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø¨
  cart = [];
  saveCart();
  updateCartUI();

  alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­");
  window.location.href = "index.html";
});

// ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
renderProduct();
updateCartUI();
</script>

</body>
</html>