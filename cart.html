<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª | TEFA STORE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Cairo", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
    }
    body {
      background: #f5f5f7;
      color: #111827;
    }
    a {
      text-decoration: none;
      color: inherit;
    }
    .page {
      max-width: 800px;
      margin: 0 auto;
      min-height: 100vh;
      background: #fff;
      display: flex;
      flex-direction: column;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 16px;
      background: #111827;
      color: #fff;
    }
    header .title {
      font-size: 18px;
      font-weight: 700;
    }
    main {
      padding: 14px 14px 22px;
      flex: 1;
    }
    .card {
      background: #f9fafb;
      border-radius: 16px;
      padding: 12px 12px 14px;
      margin-bottom: 12px;
      border: 1px solid #e5e7eb;
    }
    .card h2 {
      font-size: 15px;
      margin-bottom: 6px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 20px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #ef4444;
      color: #fff;
      margin-right: 4px;
    }
    .cart-empty {
      font-size: 13px;
      color: #6b7280;
      text-align: center;
      padding: 16px 8px;
    }
    .cart-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .cart-item {
      background: #fff;
      border-radius: 14px;
      padding: 8px 10px;
      border: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      font-size: 13px;
    }
    .cart-item-name {
      font-weight: 700;
      margin-bottom: 3px;
    }
    .cart-item-meta {
      color: #6b7280;
      font-size: 12px;
    }
    .cart-item-right {
      text-align: left;
      min-width: 80px;
    }
    .cart-item-price {
      font-weight: 700;
      margin-bottom: 4px;
    }
    .remove-btn {
      border: none;
      background: #fee2e2;
      color: #b91c1c;
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 11px;
      cursor: pointer;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin: 2px 0;
    }
    .summary-row.total {
      margin-top: 6px;
      font-size: 15px;
      font-weight: 800;
    }
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: #374151;
    }
    input, select, textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 9px 10px;
      font-size: 14px;
      outline: none;
      background: #f9fafb;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #111827;
      background: #fff;
    }
    textarea {
      min-height: 70px;
      resize: vertical;
    }
    .helper {
      font-size: 11px;
      color: #6b7280;
      margin-top: 2px;
    }
    .btn-primary {
      width: 100%;
      border-radius: 999px;
      border: none;
      padding: 12px 14px;
      font-size: 15px;
      font-weight: 800;
      background: #111827;
      color: #fff;
      cursor: pointer;
      margin-top: 6px;
    }
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: progress;
    }
    footer {
      padding: 8px 12px 14px;
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
    }
    footer a {
      color: #16a34a;
      font-weight: 600;
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <a href="index.html" style="color:#fff;">â† Ø±Ø¬ÙˆØ¹</a>
    <div class="title">Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    <span></span>
  </header>

  <main>
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ù„Ø© -->
    <section class="card">
      <h2>
        <span class="badge" id="cart-count">0</span>
        Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø©
      </h2>
      <div id="cart-empty" class="cart-empty" style="display:none;">
        Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ© Ø­Ø§Ù„ÙŠÙ‹Ø§ ğŸ§º Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¯ÙŠÙ„ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.
      </div>
      <div id="cart-list" class="cart-list"></div>
    </section>

    <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ø¹Ø± -->
    <section class="card">
      <h2>Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ø¹Ø±</h2>
      <div class="summary-row">
        <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
        <span id="sum-products">0 Ø¬</span>
      </div>
      <div class="summary-row">
        <span>Ø§Ù„Ø´Ø­Ù†</span>
        <span id="sum-shipping">0 Ø¬</span>
      </div>
      <div class="summary-row total">
        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</span>
        <span id="sum-total">0 Ø¬</span>
      </div>
    </section>

    <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„ -->
    <section class="card">
      <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h2>
      <form id="order-form">
        <div style="margin-bottom:8px;">
          <label for="name">Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
          <input id="name" required placeholder="Ù…Ø«Ø§Ù„: ÙØ§Ø·Ù…Ø© Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ" />
        </div>
        <div style="margin-bottom:8px;">
          <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ *</label>
          <input id="phone" required placeholder="01xxxxxxxxx" />
          <div class="helper">ÙŠÙÙØ¶Ù„ Ø±Ù‚Ù… Ø¹Ù„ÙŠÙ‡ ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„ØªØ£ÙƒÙŠØ¯.</div>
        </div>
        <div style="margin-bottom:8px;">
          <label for="phone2">Ø±Ù‚Ù… Ø¢Ø®Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="phone2" placeholder="Ø±Ù‚Ù… Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù„Ù„ØªÙˆØ§ØµÙ„" />
        </div>
        <div style="margin-bottom:8px;">
          <label for="governorate">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© *</label>
          <select id="governorate" required>
            <option value="">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
            <option>Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
            <option>Ø§Ù„Ø¬ÙŠØ²Ø©</option>
            <option>Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
            <option>Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©</option>
            <option>Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
            <option>Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
            <option>Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©</option>
            <option>Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©</option>
            <option>ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</option>
            <option>Ø¯Ù…ÙŠØ§Ø·</option>
            <option>Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯</option>
            <option>Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©</option>
            <option>Ø§Ù„Ø³ÙˆÙŠØ³</option>
            <option>Ø§Ù„Ø¨Ø­ÙŠØ±Ø©</option>
            <option>Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ</option>
            <option>Ø§Ù„ÙÙŠÙˆÙ…</option>
            <option>Ø§Ù„Ù…Ù†ÙŠØ§</option>
            <option>Ø£Ø³ÙŠÙˆØ·</option>
            <option>Ø³ÙˆÙ‡Ø§Ø¬</option>
            <option>Ù‚Ù†Ø§</option>
            <option>Ø§Ù„Ø£Ù‚ØµØ±</option>
            <option>Ø£Ø³ÙˆØ§Ù†</option>
            <option>Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±</option>
            <option>Ù…Ø·Ø±ÙˆØ­</option>
            <option>Ù…Ø±Ø³Ù‰ Ù…Ø·Ø±ÙˆØ­</option>
            <option>Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡</option>
            <option>Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡</option>
            <option>Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</option>
            <option>Ø´Ø±Ù… Ø§Ù„Ø´ÙŠØ®</option>
            <option>Ø§Ù„ØºØ±Ø¯Ù‚Ø©</option>
          </select>
          <div class="helper">
            Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©/Ø§Ù„Ø¬ÙŠØ²Ø©: 60 Ø¬ â€“ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª 70 Ø¬ â€“ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© (Ø´Ø±Ù… Ø§Ù„Ø´ÙŠØ®ØŒ Ø§Ù„ØºØ±Ø¯Ù‚Ø©ØŒ Ù…Ø±Ø³Ù‰ Ù…Ø·Ø±ÙˆØ­ØŒ Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡ØŒ Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡ØŒ Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯): 120 Ø¬
          </div>
        </div>
        <div style="margin-bottom:8px;">
          <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„ *</label>
          <textarea id="address" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø§Ø±Ø¹ - Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ø§Ø±Ø© - Ø§Ù„Ø¯ÙˆØ± ÙˆØ§Ù„Ø´Ù‚Ø© - Ø£Ù‚Ø±Ø¨ Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©"></textarea>
        </div>
        <div style="margin-bottom:8px;">
          <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea id="notes" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠÙ„"></textarea>
        </div>
        <div style="margin-bottom:4px;">
          <label for="weight">Ø§Ù„Ø·ÙˆÙ„ / Ø§Ù„ÙˆØ²Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="weight" placeholder="Ù…Ø«Ø§Ù„: 165 Ø³Ù… / 80 Ùƒ" />
          <div class="helper">Ø¹Ù„Ø´Ø§Ù† Ù†Ø³Ø§Ø¹Ø¯Ùƒ Ù†Ø®ØªØ§Ø± Ø£Ù†Ø³Ø¨ Ù…Ù‚Ø§Ø³ Ù„ÙŠÙƒÙŠ â¤ï¸</div>
        </div>

        <button type="submit" class="btn-primary" id="submit-btn">
          ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
        </button>
      </form>
    </section>
  </main>

  <footer>
    Ù„Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙˆØ§ØªØ³Ø§Ø¨:
    <a href="https://wa.me/201029942139" target="_blank">01029942139</a>
  </footer>
</div>

<script>
  const CART_KEY = "tefa_cart_v1";
  const SCRIPT_URL =
    "https://script.google.com/macros/s/AKfycbwPgm3Ez315GP5_E4SyM-NOjId3Whah4tdrXCRCHF1wYlk_CVwEgs4kd8WHCpJ50ggpiw/exec";

  function loadCart() {
    try {
      const raw = localStorage.getItem(CART_KEY);
      if (!raw) return [];
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    } catch (e) {
      return [];
    }
  }

  function saveCart(cart) {
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
  }

  function calcShipping(gov) {
    if (!gov) return 0;
    const remote = [
      "Ø´Ø±Ù… Ø§Ù„Ø´ÙŠØ®",
      "Ø§Ù„ØºØ±Ø¯Ù‚Ø©",
      "Ù…Ø±Ø³Ù‰ Ù…Ø·Ø±ÙˆØ­",
      "Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡",
      "Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡",
      "Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯"
    ];
    if (gov === "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©" || gov === "Ø§Ù„Ø¬ÙŠØ²Ø©") return 60;
    if (remote.includes(gov)) return 120;
    return 70;
  }

  function renderCart() {
    const cart = loadCart();
    const listEl = document.getElementById("cart-list");
    const emptyEl = document.getElementById("cart-empty");
    const countEl = document.getElementById("cart-count");

    listEl.innerHTML = "";

    if (!cart.length) {
      emptyEl.style.display = "block";
      countEl.textContent = "0";
      document.getElementById("sum-products").textContent = "0 Ø¬";
      document.getElementById("sum-shipping").textContent = "0 Ø¬";
      document.getElementById("sum-total").textContent = "0 Ø¬";
      return;
    }

    emptyEl.style.display = "none";
    const totalQty = cart.reduce((s, i) => s + (i.quantity || 1), 0);
    countEl.textContent = totalQty;

    let productsTotal = 0;

    cart.forEach((item, index) => {
      const q = item.quantity || 1;
      const p = Number(item.price) || 0;
      const lineTotal = q * p;
      productsTotal += lineTotal;

      const row = document.createElement("div");
      row.className = "cart-item";

      const left = document.createElement("div");
      const right = document.createElement("div");
      right.className = "cart-item-right";

      const nameEl = document.createElement("div");
      nameEl.className = "cart-item-name";
      nameEl.textContent = item.productName || item.name || "Ù…Ù†ØªØ¬";

      const metaEl = document.createElement("div");
      metaEl.className = "cart-item-meta";
      const colorText = item.colorName ? `Ø§Ù„Ù„ÙˆÙ†: ${item.colorName}` : "";
      metaEl.textContent = [colorText, `Ø§Ù„ÙƒÙ…ÙŠØ©: ${q}`].filter(Boolean).join(" | ");

      const priceEl = document.createElement("div");
      priceEl.className = "cart-item-price";
      priceEl.textContent = lineTotal + " Ø¬";

      const removeBtn = document.createElement("button");
      removeBtn.className = "remove-btn";
      removeBtn.textContent = "Ø­Ø°Ù";
      removeBtn.addEventListener("click", () => {
        const c = loadCart();
        c.splice(index, 1);
        saveCart(c);
        renderCart();
      });

      left.appendChild(nameEl);
      left.appendChild(metaEl);
      right.appendChild(priceEl);
      right.appendChild(removeBtn);

      row.appendChild(left);
      row.appendChild(right);

      listEl.appendChild(row);
    });

    const governorate = document.getElementById("governorate").value.trim();
    const shipping = calcShipping(governorate);
    const total = productsTotal + shipping;

    document.getElementById("sum-products").textContent =
      productsTotal + " Ø¬";
    document.getElementById("sum-shipping").textContent = shipping + " Ø¬";
    document.getElementById("sum-total").textContent = total + " Ø¬";
  }

  document
    .getElementById("governorate")
    .addEventListener("change", renderCart);

  document
    .getElementById("order-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();

      const cart = loadCart();
      if (!cart.length) {
        alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©ØŒ Ø§Ø®ØªØ§Ø±ÙŠ Ù…ÙˆØ¯ÙŠÙ„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ â¤ï¸");
        return;
      }

      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const phone2 = document.getElementById("phone2").value.trim();
      const governorate = document.getElementById("governorate").value.trim();
      const address = document.getElementById("address").value.trim();
      const notes = document.getElementById("notes").value.trim();
      const weight = document.getElementById("weight").value.trim();

      if (!name || !phone || !governorate || !address) {
        alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒÙ…Ù„ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ØŒ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†) ğŸŒ·");
        return;
      }

      const productsTotal = cart.reduce(
        (s, item) => s + (item.price || 0) * (item.quantity || 1),
        0
      );
      const shipping = calcShipping(governorate);
      const total = productsTotal + shipping;

      const productsDesc = cart
        .map((item) => {
          const q = item.quantity || 1;
          const c = item.colorName ? ` - Ù„ÙˆÙ†: ${item.colorName}` : "";
          return `${item.productName || item.name || "Ù…Ù†ØªØ¬"}${c} Ã— ${q}`;
        })
        .join(" | ");

      const payload = {
        name,
        phone,
        phone2,
        governorate,
        address,
        notes,
        weight,
        total,
        products: productsDesc
      };

      const btn = document.getElementById("submit-btn");
      btn.disabled = true;
      btn.textContent = "Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ...";

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => ({}));

        if (res.ok && data.result === "success") {
          alert("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ â¤ï¸ Ù‡Ù†ÙƒÙ„Ù…Ùƒ Ù„ØªØ£ÙƒÙŠØ¯Ù‡ ÙÙŠ Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª.");
          localStorage.removeItem(CART_KEY);
          renderCart();
          e.target.reset();
        } else {
          throw new Error("Sheet error");
        }
      } catch (err) {
        console.error(err);
        alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Google Sheet. Ù„Ùˆ Ø³Ù…Ø­ØªÙŠ ÙƒÙ„Ù…ÙŠÙ†Ø§ ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ.");
      } finally {
        btn.disabled = false;
        btn.textContent = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨";
      }
    });

  document.addEventListener("DOMContentLoaded", renderCart);
</script>
</body>
</html>