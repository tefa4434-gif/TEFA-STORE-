<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª | TEFA STORE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Cairo", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #f5f5f7;
      color: #111827;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .page {
      max-width: 720px;
      margin: 0 auto;
      min-height: 100vh;
      background: #fff;
      display: flex;
      flex-direction: column;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-bottom: 1px solid #e5e7eb;
      background: #ffffff;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .title {
      font-weight: 800;
      font-size: 18px;
    }

    main {
      padding: 12px 16px 24px;
      flex: 1;
    }

    .cart-empty {
      text-align: center;
      padding: 40px 20px;
      color: #6b7280;
      font-size: 14px;
    }

    .cart-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 16px;
    }

    .cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      background: #fafafa;
    }

    .cart-item-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .cart-item-title {
      font-size: 13px;
      font-weight: 700;
    }

    .cart-item-sub {
      font-size: 12px;
      color: #6b7280;
    }

    .cart-item-color {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }

    .cart-item-color-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid #ffffff;
      box-shadow: 0 0 0 1px #e5e7eb;
    }

    .cart-item-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .cart-item-price {
      font-size: 13px;
      font-weight: 700;
    }

    .cart-qty-controls {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
    }

    .cart-qty-btn {
      width: 26px;
      height: 26px;
      border: none;
      background: #f9fafb;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .cart-qty-value {
      min-width: 26px;
      text-align: center;
      font-size: 13px;
    }

    .cart-remove {
      font-size: 11px;
      color: #ef4444;
      border: none;
      background: none;
      cursor: pointer;
    }

    .summary {
      border-radius: 18px;
      border: 1px solid #e5e7eb;
      padding: 12px 14px;
      margin-bottom: 18px;
      background: #f9fafb;
      font-size: 13px;
    }

    .summary-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .summary-row.total {
      font-weight: 800;
      font-size: 15px;
      margin-top: 4px;
    }

    .form-section {
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      font-weight: 600;
    }

    input, select, textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    .hint {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }

    .btn-primary {
      width: 100%;
      border-radius: 999px;
      padding: 14px 18px;
      border: none;
      background: #111827;
      color: #fff;
      font-size: 15px;
      font-weight: 800;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 6px;
    }

    footer {
      padding: 10px 16px 16px;
      font-size: 11px;
      color: #9ca3af;
      text-align: center;
    }

    @media (min-width: 640px) {
      main {
        padding-inline: 24px;
      }
      footer {
        padding-inline: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <a href="index.html">â†</a>
      <div class="title">Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
      <div style="width:24px;"></div>
    </header>

    <main>
      <div id="cart-empty" class="cart-empty" style="display:none;">
        Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ© Ø­Ø§Ù„ÙŠÙ‹Ø§ ğŸ§º<br/>Ø§Ø¨Ø¯Ø£ÙŠ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ÙˆØ§Ù„Ù„ÙˆÙ† Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.
      </div>

      <div id="cart-list" class="cart-list"></div>

      <div id="summary" class="summary" style="display:none;">
        <div class="summary-row">
          <span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span>
          <span id="summary-products">0 Ø¬</span>
        </div>
        <div class="summary-row">
          <span>Ø§Ù„Ø´Ø­Ù†</span>
          <span id="summary-shipping">0 Ø¬</span>
        </div>
        <div class="summary-row total">
          <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…</span>
          <span id="summary-total">0 Ø¬</span>
        </div>
      </div>

      <form id="order-form">
        <div class="form-section">
          <label for="name">Ø§Ù„Ø§Ø³Ù… *</label>
          <input id="name" required placeholder="Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" />
        </div>

        <div class="form-section">
          <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ *</label>
          <input id="phone" required placeholder="01xxxxxxxxx" />
        </div>

        <div class="form-section">
          <label for="phone2">Ø±Ù‚Ù… Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø¨Ø¯ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="phone2" placeholder="Ù„Ù„ØªØ£ÙƒÙŠØ¯ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„" />
        </div>

        <div class="form-section">
          <label for="governorate">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© *</label>
          <select id="governorate" required>
            <option value="">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
            <option>Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
            <option>Ø§Ù„Ø¬ÙŠØ²Ø©</option>
            <option>Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
            <option>Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©</option>
            <option>Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©</option>
            <option>Ø§Ù„ØºØ±Ø¨ÙŠØ©</option>
            <option>Ø§Ù„Ø´Ø±Ù‚ÙŠØ©</option>
            <option>Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©</option>
            <option>ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®</option>
            <option>Ø¯Ù…ÙŠØ§Ø·</option>
            <option>Ø§Ù„Ø¨Ø­ÙŠØ±Ø©</option>
            <option>Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯</option>
            <option>Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©</option>
            <option>Ø§Ù„Ø³ÙˆÙŠØ³</option>
            <option>Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ</option>
            <option>Ø§Ù„ÙÙŠÙˆÙ…</option>
            <option>Ø§Ù„Ù…Ù†ÙŠØ§</option>
            <option>Ø£Ø³ÙŠÙˆØ·</option>
            <option>Ø³ÙˆÙ‡Ø§Ø¬</option>
            <option>Ù‚Ù†Ø§</option>
            <option>Ø§Ù„Ø£Ù‚ØµØ±</option>
            <option>Ø£Ø³ÙˆØ§Ù†</option>
            <option>Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±</option>
            <option>Ù…Ø·Ø±ÙˆØ­</option>
            <option>Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡</option>
            <option>Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡</option>
            <option>Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯</option>
            <option>Ø´Ø±Ù… Ø§Ù„Ø´ÙŠØ®</option>
          </select>
          <div class="hint">
            Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© ÙˆØ§Ù„Ø¬ÙŠØ²Ø©: 60 Ø¬ â€“ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª: 70 Ø¬ â€“ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø§Ù„Ø¨Ø¹ÙŠØ¯Ø© (Ø´Ø±Ù… Ø§Ù„Ø´ÙŠØ®ØŒ Ø§Ù„ØºØ±Ø¯Ù‚Ø©ØŒ Ù…Ø±Ø³Ù‰ Ù…Ø·Ø±ÙˆØ­ØŒ Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡ØŒ Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡ØŒ Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯): 120 Ø¬
          </div>
        </div>

        <div class="form-section">
          <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„ *</label>
          <input id="address" required placeholder="Ø§Ù„Ø´Ø§Ø±Ø¹ - Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ø§Ø±Ø© - Ø£Ù‚Ø±Ø¨ Ø¹Ù„Ø§Ù…Ø© Ù…Ù…ÙŠØ²Ø©" />
        </div>

        <div class="form-section">
          <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù„Ù„Ø·Ù„Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <textarea id="notes" placeholder="Ù…Ø«Ø§Ù„: Ù…Ù‚Ø§Ø³ ÙˆØ§Ø³Ø¹ Ø´ÙˆÙŠØ©ØŒ ÙŠÙØ¶Ù„ Ø§ØªØµØ§Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø´Ø­Ù† .."></textarea>
        </div>

        <div class="form-section">
          <label for="weight">Ø§Ù„Ø·ÙˆÙ„ Ø£Ùˆ Ø§Ù„ÙˆØ²Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="weight" placeholder="Ù…Ø«Ø§Ù„: 165 Ø³Ù… / 80 Ùƒ" />
          <div class="hint">ÙŠØ³Ø§Ø¹Ø¯Ù†Ø§ Ù†Ø®ØªØ§Ø± Ø£Ù†Ø³Ø¨ Ù…Ù‚Ø§Ø³ Ù„ÙŠÙƒÙŠ â¤ï¸</div>
        </div>

        <button type="submit" class="btn-primary">
          <span>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</span>
        </button>
      </form>
    </main>

    <footer>
      Ù„Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙˆØ§ØªØ³Ø§Ø¨: 010209942139
    </footer>
  </div>

  <script>
    const CART_KEY = "tefa_cart_v1";
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwPgm3Ez315GP5_E4SyM-NOjId3Whah4tdrXCRCHF1wYlk_CVwEgs4kd8WHCpJ50ggpiw/exec";

    function loadCart() {
      try {
        const raw = localStorage.getItem(CART_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch {
        return [];
      }
    }

    function saveCart(cart) {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
      renderCart();
    }

    function calcShipping(governorate) {
      if (!governorate) return 0;
      const g = governorate.trim();
      const remote = ["Ø´Ø±Ù… Ø§Ù„Ø´ÙŠØ®","Ø§Ù„ØºØ±Ø¯Ù‚Ø©","Ù…Ø±Ø³Ù‰ Ù…Ø·Ø±ÙˆØ­","Ù…Ø·Ø±ÙˆØ­","Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡","Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡","Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯","Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±"];
      if (g === "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©" || g === "Ø§Ù„Ø¬ÙŠØ²Ø©") return 60;
      if (remote.includes(g)) return 120;
      return 70;
    }

    function renderCart() {
      const cart = loadCart();
      const listEl = document.getElementById("cart-list");
      const emptyEl = document.getElementById("cart-empty");
      const summaryEl = document.getElementById("summary");

      listEl.innerHTML = "";

      if (!cart.length) {
        emptyEl.style.display = "block";
        summaryEl.style.display = "none";
        return;
      }

      emptyEl.style.display = "none";

      let productsTotal = 0;

      cart.forEach((item, index) => {
        const lineTotal = item.price * item.quantity;
        productsTotal += lineTotal;

        const row = document.createElement("div");
        row.className = "cart-item";

        row.innerHTML = `
          <div class="cart-item-main">
            <div class="cart-item-title">${item.productName}</div>
            <div class="cart-item-sub">Ø§Ù„Ù„ÙˆÙ†: 
              <span class="cart-item-color">
                <span class="cart-item-color-dot" style="background:${item.colorHex || "#111"}"></span>
                <span>${item.colorLabel}</span>
              </span>
            </div>
          </div>
          <div class="cart-item-right">
            <div class="cart-item-price">${lineTotal} Ø¬</div>
            <div class="cart-qty-controls">
              <button type="button" class="cart-qty-btn" data-index="${index}" data-action="minus">âˆ’</button>
              <div class="cart-qty-value">${item.quantity}</div>
              <button type="button" class="cart-qty-btn" data-index="${index}" data-action="plus">+</button>
            </div>
            <button type="button" class="cart-remove" data-index="${index}">Ø­Ø°Ù</button>
          </div>
        `;

        listEl.appendChild(row);
      });

      const governorate = document.getElementById("governorate").value;
      const shipping = calcShipping(governorate);
      const total = productsTotal + shipping;

      document.getElementById("summary-products").textContent = productsTotal + " Ø¬";
      document.getElementById("summary-shipping").textContent = shipping + " Ø¬";
      document.getElementById("summary-total").textContent = total + " Ø¬";

      summaryEl.style.display = "block";
    }

    document.getElementById("cart-list").addEventListener("click", (e) => {
      const cart = loadCart();
      const btn = e.target;

      if (btn.classList.contains("cart-qty-btn")) {
        const index = Number(btn.dataset.index);
        const action = btn.dataset.action;
        const item = cart[index];
        if (!item) return;

        if (action === "plus") {
          item.quantity = Math.min(20, item.quantity + 1);
        } else if (action === "minus") {
          item.quantity = Math.max(1, item.quantity - 1);
        }
        saveCart(cart);
      }

      if (btn.classList.contains("cart-remove")) {
        const index = Number(btn.dataset.index);
        cart.splice(index, 1);
        saveCart(cart);
      }
    });

    document.getElementById("governorate").addEventListener("change", () => {
      renderCart();
    });

    document.getElementById("order-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const cart = loadCart();
      if (!cart.length) {
        alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ© Ø­Ø§Ù„ÙŠÙ‹Ø§ØŒ Ø¶ÙŠÙÙŠ Ù…Ù†ØªØ¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ğŸ§º");
        return;
      }

      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const phone2 = document.getElementById("phone2").value.trim();
      const governorate = document.getElementById("governorate").value.trim();
      const address = document.getElementById("address").value.trim();
      const notes = document.getElementById("notes").value.trim();
      const weight = document.getElementById("weight").value.trim();

      if (!name || !phone || !governorate || !address) {
        alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø¦ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ØŒ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†).");
        return;
      }

      const productsSummary = cart
        .map(
          item =>
            `${item.productName} â€“ ${item.colorLabel} Ã— ${item.quantity}`
        )
        .join(" | ");

      const productsTotal = cart.reduce(
        (sum, item) => sum + item.price * item.quantity,
        0
      );
      const shipping = calcShipping(governorate);
      const total = productsTotal + shipping;

      const payload = {
        name,
        phone,
        phone2,
        governorate,
        address,
        notes,
        weight,
        total,
        products: productsSummary
      };

      try {
        const res = await fetch(GOOGLE_SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => ({}));

        if (res.ok && data.result === "success") {
          alert("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ â¤ï¸ Ù‡Ù†ÙƒÙ„Ù…Ùƒ Ù„ØªØ£ÙƒÙŠØ¯Ù‡ ÙÙŠ Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª.");
          localStorage.removeItem(CART_KEY);
          renderCart();
          e.target.reset();
        } else {
          alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Google Sheet. Ù„Ùˆ Ø³Ù…Ø­ØªÙŠ ÙƒÙ„Ù…ÙŠÙ†Ø§ ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ.");
        }
      } catch (err) {
        alert("ÙÙŠ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Google Sheet. Ù„Ùˆ Ø³Ù…Ø­ØªÙŠ ÙƒÙ„Ù…ÙŠÙ†Ø§ ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨Ùƒ.");
      }
    });

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø©
    renderCart();
  </script>
</body>
</html>